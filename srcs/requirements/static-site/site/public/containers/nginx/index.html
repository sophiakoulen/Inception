<!DOCTYPE html>
<html class="dark light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    
    
    <title>
         Nginx
        
    </title>

        
            <meta property="og:title" content="Nginx" />
        
     

     
         
     

     
         
    

    
    
        <link rel="icon" type="image/png" href=&#x2F;icon&#x2F;favicon.png />
    

    
    
        <link href=http://localhost:8081/fonts.css rel="stylesheet" />
    

    
    


    

    
    <link rel="alternate" type="application/atom+xml" title="Inception" href="http://localhost:8081/atom.xml">


    
    
        <link rel="stylesheet" type="text/css" href=http://localhost:8081/theme/light.css />
        <link id="darkModeStyle" rel="stylesheet" type="text/css" href="http://localhost:8081/theme/dark.css" />
    

    <link rel="stylesheet" type="text/css" media="screen" href=http://localhost:8081/main.css />

    
</head>

<body>
    <div class="content">
        <header>
    <div class="main">
        <a href=http:&#x2F;&#x2F;localhost:8081>Inception</a>

        <div class="socials">
            
            <a rel="me" href="https:&#x2F;&#x2F;github.com&#x2F;sophiakoulen&#x2F;Inception" class="social">
                <img alt=github src="/social_icons/github.svg">
            </a>
            
        </div>
    </div>

    <nav>
        
        <a href=&#x2F; style="margin-left: 0.7em">&#x2F;home</a>
        
        <a href=&#x2F;containers style="margin-left: 0.7em">&#x2F;containers</a>
        

        
        | <a id="dark-mode-toggle" onclick="toggleTheme()" href="javascript:void(0)">
            <img src="/feather/sun.svg" id="sun-icon" style="filter: invert(1);" />
            <img src="/feather/moon.svg" id="moon-icon" />
        </a>
        <script src=http://localhost:8081/js/themetoggle.js></script>
    </nav>
    
</header>

        
        
    
<main>
    <article>
        <div class="title">
            
            
    <div class="page-header">
        Nginx<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>


                <div class="meta">
                    
                        Posted on <time>2023-10-07</time>
                    

                    
                </div>
        </div>

        

        
        
            
                <h1>Table of Contents</h1>
                <ul>
                
                    <li>
                        <a href="http://localhost:8081/containers/nginx/#about">About</a>
                        
                    </li>
                
                    <li>
                        <a href="http://localhost:8081/containers/nginx/#dockerfile">Dockerfile</a>
                        
                    </li>
                
                    <li>
                        <a href="http://localhost:8081/containers/nginx/#entrypoint">Entrypoint</a>
                        
                    </li>
                
                    <li>
                        <a href="http://localhost:8081/containers/nginx/#config">config</a>
                        
                    </li>
                
                </ul>
            
        

        <section class="body">
            <h2 id="about">About</h2>
<p>Nginx is a webserver.
We will use an instance of nginx to serve our wordpress files.</p>
<h2 id="dockerfile">Dockerfile</h2>
<pre data-lang="Dockerfile" style="background-color:#2b303b;color:#c0c5ce;" class="language-Dockerfile "><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#b48ead;">FROM</span><span> alpine:3.17
</span><span>
</span><span style="color:#b48ead;">RUN </span><span>apk add --no-cache nginx gettext
</span><span>
</span><span style="color:#65737e;">#copy config files
</span><span style="color:#b48ead;">COPY</span><span> conf/ /etc/nginx/http.d/
</span><span>
</span><span style="color:#65737e;">#copy SSL certificate
</span><span style="color:#b48ead;">COPY</span><span> certs/ /etc/nginx/certs
</span><span>
</span><span style="color:#b48ead;">EXPOSE </span><span>443 8080
</span><span>
</span><span style="color:#b48ead;">COPY</span><span> tools/nginx-entrypoint.sh /
</span><span>
</span><span>ENTRYPOINT [&quot;</span><span style="color:#a3be8c;">/nginx-entrypoint.sh</span><span>&quot;]
</span><span>
</span><span>CMD [&quot;</span><span style="color:#a3be8c;">nginx</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">-g</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">daemon off;</span><span>&quot;]
</span></code></pre>
<h2 id="entrypoint">Entrypoint</h2>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#65737e;">#!/bin/sh
</span><span>
</span><span style="color:#96b5b4;">set </span><span style="color:#bf616a;">-e
</span><span style="color:#bf616a;">defined_envs</span><span>=$</span><span style="color:#a3be8c;">(</span><span style="color:#96b5b4;">printf </span><span>&#39;</span><span style="color:#a3be8c;">${%s} </span><span>&#39; $</span><span style="color:#a3be8c;">(</span><span style="color:#bf616a;">awk </span><span>&quot;</span><span style="color:#a3be8c;">END { for (name in ENVIRON) { print ( name ~ /</span><span>$</span><span style="color:#a3be8c;">{</span><span style="color:#bf616a;">filter</span><span style="color:#a3be8c;">}/ ) ? name : </span><span style="color:#96b5b4;">\&quot;\&quot;</span><span style="color:#a3be8c;"> } }</span><span>&quot; &lt;</span><span style="color:#a3be8c;"> /dev/null ))
</span><span style="color:#bf616a;">FILES</span><span>=&quot;</span><span style="color:#a3be8c;">/etc/nginx/http.d/*.template</span><span>&quot;
</span><span style="color:#b48ead;">for</span><span> template </span><span style="color:#b48ead;">in </span><span>$</span><span style="color:#bf616a;">FILES
</span><span style="color:#b48ead;">do
</span><span>	</span><span style="color:#bf616a;">output</span><span>=&quot;$</span><span style="color:#a3be8c;">{</span><span style="color:#bf616a;">template</span><span>%</span><span style="color:#a3be8c;">.</span><span>*</span><span style="color:#a3be8c;">}</span><span>&quot;
</span><span>	</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">template: </span><span>$</span><span style="color:#bf616a;">template</span><span>&quot;
</span><span>	</span><span style="color:#96b5b4;">echo </span><span>&quot;</span><span style="color:#a3be8c;">output: </span><span>$</span><span style="color:#bf616a;">output</span><span>&quot;
</span><span>	</span><span style="color:#bf616a;">envsubst </span><span>&quot;$</span><span style="color:#bf616a;">defined_envs</span><span>&quot; &lt;$</span><span style="color:#bf616a;">template  </span><span>&gt;$</span><span style="color:#bf616a;">output
</span><span style="color:#b48ead;">done
</span><span>
</span><span style="color:#96b5b4;">exec </span><span>&quot;$</span><span style="color:#bf616a;">@</span><span>&quot;
</span></code></pre>
<h2 id="config">config</h2>
<pre data-lang="nginx" style="background-color:#2b303b;color:#c0c5ce;" class="language-nginx "><code class="language-nginx" data-lang="nginx"><span>server {
</span><span>	server_name			${DOMAIN};
</span><span>    
</span><span>	listen 				443 ssl;
</span><span>	listen				[::]:443 ssl;
</span><span>	
</span><span>	ssl_certificate		/etc/nginx/certs/${DOMAIN}.crt;
</span><span>	ssl_certificate_key	/etc/nginx/certs/${DOMAIN}.key;
</span><span>	ssl_protocols		TLSv1.2 TLSv1.3;
</span><span>	ssl_certificate_key	HIGH:!aNULL:!MD5;
</span><span>
</span><span>    access_log  /var/log/nginx/wp.access.log;
</span><span>    error_log   /var/log/nginx/wp.error.log;
</span><span>
</span><span>	root /var/www/html;
</span><span>    index index.php; 
</span><span>
</span><span>    location / {
</span><span>        try_files $uri $uri/ /index.php?$args;
</span><span>    }
</span><span>
</span><span>    rewrite /wp-admin$ $scheme://$host$uri/ permanent;
</span><span>
</span><span>    location ~ \.php$ {
</span><span>		try_files $uri =404;
</span><span>		fastcgi_split_path_info ^(.+\.php)(/.+)$;
</span><span>        fastcgi_pass   wordpress:9000;
</span><span>        fastcgi_index  index.php; 
</span><span>        include fastcgi_params;
</span><span>        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
</span><span>        fastcgi_param PATH_INFO       $fastcgi_path_info;
</span><span>        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
</span><span>    } 
</span><span>}
</span></code></pre>

        </section>

        

    </article>
</main>


    </div>
</body>

</html>